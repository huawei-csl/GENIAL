<!-- SPDX-License-Identifier: BSD-3-Clause Clear
Copyright (c) 2024-2025 HUAWEI.
All rights reserved.
This software is released under the BSD 3-Clause Clear License.
See the LICENSE file in the project root for full license information (https://github.com/huawei-csl/GENIAL).
 -->


# RedZone Adaptation Folder Explanation
- [RedZone Adaptation Folder Explanation](#redzone-adaptation-folder-explanation)
  - [What the Testbench Generator Does](#what-the-testbench-generator-does)
  - [List of Provided Files Description](#list-of-provided-files-description)
    - [For running the testbench generator](#for-running-the-testbench-generator)
    - [For synthesizing the design](#for-synthesizing-the-design)
    - [For running the simulation](#for-running-the-simulation)
  - [Python requirements](#python-requirements)
    - [Testbench Generation](#testbench-generation)
      - [Python Version](#python-version)
      - [Python Dependencies](#python-dependencies)
    - [Testbench Execution](#testbench-execution)
      - [Python Version](#python-version-1)
      - [Python Dependencies](#python-dependencies-1)
  - [Launch the standalone testbench generator](#launch-the-standalone-testbench-generator)


## What the Testbench Generator Does
The standalaon testbench generator script reads:
- the design file to extract the encodings
    - the encodings are given as comments inside the verilog file
- the netlist to extract the wire list
    - it parses the netlists and extract wires from regular expression patterns and given valid port names to detect input and output wires fopr each cells
It can also clean the netlist to simplify simulation by changing the names of gates (generated by the synthesis tool) to gates known for simulation.

## List of Provided Files Description
### For running the testbench generator
 - `mydesign_comb.v`: original design file used for syntesis. Only include the combinational part of the design. Here it is a 3b multiplier with unconventional inut encoding described as a lookup table. (Also used for synthesis, not only TB generation.)
 - `sample_mydesign_yosys.v`: sample of associated synthesized design by yosys. This can be used to run and understand how the testbench generator operates.
 - `testbench.py.temp`: template of the testbench used by the generator.

### For synthesizing the design
 - `synthesis_files/mydesign_top.v`: original design file used for synthesis and includes output registers. Calls the `_comb` design internally as the combinationl block.
 - `mydesign_comb.v`: also required here as this is the design definition.

### For running the simulation
 - `simulation_files/Makefile_PostSynth.mk`: cocotb-type makefile used for post-synthesis simulation. Note that the path for the verilog dependencies will have to be adapted.
 - `simulation_files/mydesign_synth_wrapper.v`: verilog wrapper of the synthesized netlist used for simulation of the syntesized design
 - `simulation_files/notech_primitives.v`: verilog description of the behavior of notech cells used for post-synthesis simulation.


## Python requirements
### Testbench Generation
#### Python Version
For now, the testbench generator has only been tested with python 3.12.3
#### Python Dependencies
But it does not require any depency

### Testbench Execution
#### Python Version
For now, executing the testbench has only been tested with python 3.12.3
#### Python Dependencies
- Required
    - cocotb==1.8.1
    - numpy==2.0.0
- Optional | good to have
    - pandas==2.2.2
- Optional | don't care
    - pyarrow==17.0.0


## Launch the standalone testbench generator
To launch (and test) the testbench generator, simply run the following command:
```bash
python src/adder_analysis/testbench_generator_standalone.py \
 --tbtemp_filepath src/adder_analysis/templates_and_launch_scripts/1_redzone_adaptation/testbench.py.temp \
 --design_filepath src/adder_analysis/templates_and_launch_scripts/1_redzone_adaptation/sample_mydesign_comb.v \ 
 --synth_filepath src/adder_analysis/templates_and_launch_scripts/1_redzone_adaptation/sample_mydesign_yosys.v \
 --output_dirpath debug/testbench_generator_standalone
```
> **NOTE:** You can change the --output_dirpath target as best fit your purpose. The output folder will be created by the python script.
